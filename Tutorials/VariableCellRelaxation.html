---
layout: page
---

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Quantum-variable-cell-relaxation-of-LaH10">Quantum variable cell relaxation of LaH10<a class="anchor-link" href="#Quantum-variable-cell-relaxation-of-LaH10">&#182;</a></h1><p>In this tutorial we will replicate the results of the work <a href="https://www.nature.com/articles/s41586-020-1955-z">Errea et. al, Nature 578, 66â€“69(2020)</a>, where they show how the rombohedral structure R-3m of LaH10, global minimum of the Born-Oppenheimer (BO) energy landscape, to collapse into the higher symmetry Fm-3m at low pressure, where this phase is unstable within the harmonic approximation.</p>
<p><em>Note</em>: We will use underconverged parameters to be able run the calculation on a local computer, for production runs you must study the convergence, especially with K point sampling and the supercell size.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For this tutorial, we provide a dynamical matrix, obtained by a sscha relaxation at fixed cell (see tutorial on H3S for example).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">pylab</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Using matplotlib backend: Qt5Agg
Populating the interactive namespace from numpy and matplotlib
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-ab-initio-parameters">The ab-initio parameters<a class="anchor-link" href="#The-ab-initio-parameters">&#182;</a></h2><p>Here we setup the calculator to compute the energy, forces and pressures of the BO energy landscape. Please, refer to <a href="https://www.quantum-espresso.org/Doc/INPUT_PW.html">Espresso pw.x guide</a> for the detailed description on the input parameters, and <a href="https://wiki.fysik.dtu.dk/ase/ase/calculators/espresso.html">ASE Espresso calculator</a> for a description on how to properly setup an Espresso calculator suited for your application.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">ase</span>
<span class="kn">from</span> <span class="nn">ase.calculators.espresso</span> <span class="k">import</span> <span class="n">Espresso</span>

<span class="kn">import</span> <span class="nn">cellconstructor</span> <span class="k">as</span> <span class="nn">CC</span>
<span class="kn">import</span> <span class="nn">cellconstructor.Phonons</span>

<span class="kn">import</span> <span class="nn">sscha</span><span class="o">,</span> <span class="nn">sscha.Ensemble</span><span class="o">,</span> <span class="nn">sscha.SchaMinimizer</span><span class="o">,</span> <span class="nn">sscha.Relax</span>

<span class="n">pseudo</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="s2">&quot;H.pbe-rrkjus_psl.1.0.0.UPF&quot;</span><span class="p">,</span>
         <span class="s2">&quot;La&quot;</span> <span class="p">:</span> <span class="s2">&quot;La.pbe-spfn-rrkjus_psl.1.0.0.UPF&quot;</span><span class="p">}</span>
<span class="n">input_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tstress&quot;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="c1"># Print the stress in the output</span>
                <span class="s2">&quot;tprnfor&quot;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="c1"># Print the forces in the output</span>
                <span class="s2">&quot;ecutwfc&quot;</span> <span class="p">:</span> <span class="mi">35</span><span class="p">,</span>  <span class="c1">#The wavefunction energy cutoff for plane-waves (Ry)</span>
                <span class="s2">&quot;ecutrho&quot;</span> <span class="p">:</span> <span class="mi">350</span><span class="p">,</span> <span class="c1"># The density energy cutoff (Ry)</span>
                <span class="s2">&quot;mixing_beta&quot;</span> <span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>  <span class="c1"># The mixing parameter in the self-consistent calculation</span>
                <span class="s2">&quot;conv_thr&quot;</span> <span class="p">:</span> <span class="mf">1e-9</span><span class="p">,</span>    <span class="c1"># The energy convergence threshold (Ry)</span>
                <span class="s2">&quot;degauss&quot;</span> <span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span>  <span class="c1"># Smearing temperature (Ry)</span>
                <span class="s2">&quot;smearing&quot;</span> <span class="p">:</span> <span class="s2">&quot;mp&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pseudo_dir&quot;</span> <span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;occupations&quot;</span> <span class="p">:</span> <span class="s2">&quot;smearing&quot;</span><span class="p">,</span>
               <span class="s2">&quot;disk_io&quot;</span> <span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">}</span>

<span class="n">k_points</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span> <span class="c1"># The k points grid (you can alternatively specify a kspacing)</span>
<span class="n">k_offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># The offset of the grid (can increase convergence)</span>

<span class="n">espresso_calc</span> <span class="o">=</span> <span class="n">Espresso</span><span class="p">(</span><span class="n">pseudopotentials</span> <span class="o">=</span> <span class="n">pseudo</span><span class="p">,</span> <span class="n">input_data</span> <span class="o">=</span> <span class="n">input_params</span><span class="p">,</span> 
                        <span class="n">kpts</span> <span class="o">=</span> <span class="n">k_points</span><span class="p">,</span> <span class="n">koffset</span> <span class="o">=</span> <span class="n">k_offset</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-preparation-of-the-minimization">The preparation of the minimization<a class="anchor-link" href="#The-preparation-of-the-minimization">&#182;</a></h2><p>In the following cell we prepare the minimization parameters and the ensemble.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># We now load the dynamical matrix</span>
<span class="n">dyn</span> <span class="o">=</span> <span class="n">CC</span><span class="o">.</span><span class="n">Phonons</span><span class="o">.</span><span class="n">Phonons</span><span class="p">(</span><span class="s2">&quot;dyn&quot;</span><span class="p">)</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">Symmetrize</span><span class="p">()</span> <span class="c1">#Enforce the sum rule</span>

<span class="c1"># We prepare the ensemble</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">sscha</span><span class="o">.</span><span class="n">Ensemble</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">T0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">supercell</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">GetSupercell</span><span class="p">())</span>

<span class="c1"># We prepare the sscha minimizer</span>
<span class="n">minim</span> <span class="o">=</span> <span class="n">sscha</span><span class="o">.</span><span class="n">SchaMinimizer</span><span class="o">.</span><span class="n">SSCHA_Minimizer</span><span class="p">(</span><span class="n">ensemble</span><span class="p">)</span>

<span class="c1"># We set up the minimization parameters</span>
<span class="n">minim</span><span class="o">.</span><span class="n">min_step_dyn</span> <span class="o">=</span> <span class="mf">0.05</span>     <span class="c1"># The minimization step on the dynamical matrix</span>
<span class="n">minim</span><span class="o">.</span><span class="n">min_step_struc</span> <span class="o">=</span> <span class="mf">0.05</span>   <span class="c1"># The minimization step on the structure</span>
<span class="n">minim</span><span class="o">.</span><span class="n">kong_liu_ratio</span> <span class="o">=</span> <span class="mf">0.5</span>     <span class="c1"># The parameter that estimates whether the ensemble is still good</span>
<span class="n">minim</span><span class="o">.</span><span class="n">gradi_op</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span> <span class="c1"># Check the stopping condition on both gradients</span>
<span class="n">minim</span><span class="o">.</span><span class="n">meaningful_factor</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># How much small the gradient should be before I stop?</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We setup the standard sscha minimiztion. Now we must prepare the calculator for the automatic relaxation exactly like we did for the H3S example.
Remember you can always specify a cluster for the automatic calculation:</p>
<p><em>In the case you want to use this cluster, please remember to upload the pseudos on the cluster working directory!</em></p>
<p>Skip the following cell if you do not want to setup a cluster, and run the calculation locally.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Here we prepare a cluster</span>
<span class="c1"># Here we configure the cluster object MARCONI</span>
<span class="kn">import</span> <span class="nn">sscha.Cluster</span>
<span class="n">my_hpc</span> <span class="o">=</span> <span class="n">sscha</span><span class="o">.</span><span class="n">Cluster</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span><span class="n">pwd</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>

<span class="c1"># We setup the connection info</span>
<span class="n">my_hpc</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;ekhi&quot;</span> <span class="c1"># The command to connect via ssh to the cluster</span>
<span class="c1">#my_hpc.account_name = &quot;IscrB_COMRED&quot; # The name of the project for the computation</span>
<span class="n">my_hpc</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="s2">&quot;/scratch/lorenzo/my_calculation&quot;</span> <span class="c1"># the directory in which the calculations are performed</span>

<span class="c1"># Now we need to setup the espresso</span>
<span class="c1"># First we must tell the cluster where to find him:</span>
<span class="n">my_hpc</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="s2">&quot;pw.x -npool NPOOL -i  PREFIX.pwi &gt; PREFIX.pwo&quot;</span>
<span class="c1"># Then we need to specify if some modules must be loaded in the submission script</span>
<span class="n">my_hpc</span><span class="o">.</span><span class="n">load_modules</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"># Here this is a bash script at the beginning of the submission</span>
<span class="s2"># We can load modules</span>

<span class="s2">module load QuantumESPRESSO</span>
<span class="s2">export OMP_NUM_THREADS=1</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># All these information are independent from the calculation</span>
<span class="c1"># Now we need some more specific info, like the number of processors, pools and other stuff</span>
<span class="n">my_hpc</span><span class="o">.</span><span class="n">n_cpu</span> <span class="o">=</span> <span class="mi">32</span> <span class="c1"># We will use 32 processors</span>
<span class="n">my_hpc</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#In 1 node</span>
<span class="n">my_hpc</span><span class="o">.</span><span class="n">n_pool</span> <span class="o">=</span> <span class="mi">16</span> <span class="c1"># This is an espresso specific tool, the parallel CPU are divided in 4 pools</span>

<span class="c1"># We can also choose in how many batch of jobs we want to submit simultaneously, and how many configurations for each job</span>
<span class="n">my_hpc</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">my_hpc</span><span class="o">.</span><span class="n">job_number</span> <span class="o">=</span> <span class="mi">20</span>
<span class="c1"># In this way we submit 10 jobs, each one with 10 configurations (overall 100 configuration at time)</span>

<span class="c1"># We give 25 seconds of timeout</span>
<span class="n">my_hpc</span><span class="o">.</span><span class="n">set_timeout</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>

<span class="c1"># We can specify the time limit for each job,</span>
<span class="n">my_hpc</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="s2">&quot;00:10:00&quot;</span> <span class="c1"># 5 minutes</span>

<span class="c1"># Create the working directory if none on the cluster </span>
<span class="c1"># And check the connection</span>
<span class="n">my_hpc</span><span class="o">.</span><span class="n">setup_workdir</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Prepare-the-automatic-relaxation">Prepare the automatic relaxation<a class="anchor-link" href="#Prepare-the-automatic-relaxation">&#182;</a></h2><p>Now we prepare the relaxation object. 
We use the same object (SSCHA) inside the Relax module as we did for the H3S example.
set my_hpc to None if you want to run the calculation locally</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Decomment the following line if you did not set up the cluster</span>
<span class="c1">#my_hpc = None</span>

<span class="n">relax</span> <span class="o">=</span> <span class="n">sscha</span><span class="o">.</span><span class="n">Relax</span><span class="o">.</span><span class="n">SSCHA</span><span class="p">(</span><span class="n">minim</span><span class="p">,</span> <span class="n">ase_calculator</span> <span class="o">=</span> <span class="n">espresso_calc</span><span class="p">,</span>
                         <span class="n">N_configs</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>
                         <span class="n">max_pop</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
                         <span class="n">save_ensemble</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="n">cluster</span> <span class="o">=</span> <span class="n">my_hpc</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This time we are interested in plotting the symmetry analisys, as we evolve the minimization</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spglib</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The original spacegroup is:&quot;</span><span class="p">,</span> <span class="n">spglib</span><span class="o">.</span><span class="n">get_spacegroup</span><span class="p">(</span><span class="n">dyn</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_ase_atoms</span><span class="p">(),</span> <span class="mf">0.05</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The original spacegroup is: R-3m (166)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We create a custom function to print the spacegroup after each iteration of the minimization.
In this way we can follow the evolution of the dynamical matrix as it evolves.
We use a threshold for symmetries of 0.05 A. Remember that the SSCHA is a stochastic method, the atomic position is affected by stochastic noise.
If you want to increase your accuracy in the identification of the spacegroup, you should accordingly increase the number of configurations, remember that the stochastic noise scales as $1/\sqrt{N_{configs}}$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># we define a function that prints the space group during the optimization</span>
<span class="n">space_groups</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">print_spacegroup</span><span class="p">(</span><span class="n">minim</span><span class="p">):</span>
    <span class="n">spgroup</span> <span class="o">=</span> <span class="n">spglib</span><span class="o">.</span><span class="n">get_spacegroup</span><span class="p">(</span><span class="n">minim</span><span class="o">.</span><span class="n">dyn</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_ase_atoms</span><span class="p">(),</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">space_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spgroup</span><span class="p">)</span>
    
    <span class="c1"># We can save them in the output at each minimization step</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;space_group.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">) </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">space_groups</span><span class="p">)])</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
<span class="n">relax</span><span class="o">.</span><span class="n">setup_custom_functions</span><span class="p">(</span><span class="n">custom_function_post</span> <span class="o">=</span> <span class="n">print_spacegroup</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Perform-the-variable-cell-relaxation">Perform the variable cell relaxation<a class="anchor-link" href="#Perform-the-variable-cell-relaxation">&#182;</a></h2><p>We are ready to start a variable cell relaxation. There are two different variable cell relaxations implemented in the SSCHA code: target pressure or fixed volume.
In the target pressure calculation, the SSCHA adapts the cell until the stress stress tensor is uniform and reproduces the pressure we want. In this calculation the volume changes. In the fixed volume, instead, the SSCHA optimizes the cell parameters keeping the overall volume unchanged.</p>
<p>We will use the latter in this example, but feel free to experiment by selecting fix_volume to false, and manually change the target_pressure argument. I prepared another command (commented) to perform a variable cell relaxation with target pressure.</p>
<p>The advantage of keeping the volume fixed is that we reduce the number of degrees of freedom in the cell optimization.</p>
<p>The static_bulk_modulus is a flag that allow the program to estimate, given the stress tensor, how to change the unit cell to reach the optimal value in the lowest number of steps. A good value is the static bulk modulus, that is the derivative pressure with respect to the volume times the volume. The code expects it in GPa.
Usually for high pressure materials, the bulk modulus is around hundreds of GPa, while for ice at ambient pressure is about 10 GPa. A high value of the bulk modulus will mean a slower change in the unit cell, so if you have the fealing that the unit cell is not changing a lot between sequent steps, try to reduce it.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Now we can run the calculation!!!</span>
<span class="c1"># In this case we fix the volume (we optimize lattice parameters)</span>
<span class="c1"># But you can also fixe the target pressure (as done in the commented line)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;ensembles&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;ensembles&quot;</span><span class="p">)</span>
<span class="n">relax</span><span class="o">.</span><span class="n">vc_relax</span><span class="p">(</span><span class="n">fix_volume</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">static_bulk_modulus</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span> <span class="n">ensemble_loc</span> <span class="o">=</span> <span class="s2">&quot;ensembles&quot;</span><span class="p">)</span>
<span class="c1">#relax.vc_relax(target_press = 120, static_bulk_modulus = 200, ensemble_loc = &quot;ensembles&quot;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Results">Results<a class="anchor-link" href="#Results">&#182;</a></h2><p>The minimization is done, now we can study the evolution of the Rombohedral angle in subsequent populations
<img src="romb_ang.png" alt="Rombohedral angle"></p>
<p>As you can see, the angle is getting close to 60 degrees. 
We can see if it recognize a closer high symmetry structure.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[66]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">relax</span><span class="o">.</span><span class="n">minim</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
<span class="n">relax</span><span class="o">.</span><span class="n">minim</span><span class="o">.</span><span class="n">plot_results</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>
 * * * * * * * * 
 *             * 
 *   RESULTS   * 
 *             * 
 * * * * * * * * 


Minimization ended after 432 steps

Free energy = -1853233.86250700 +-       6.13461465 meV
FC gradient modulus =       3.00827542 +-       3.10405062 bohr^2
Struct gradient modulus =      40.59413639 +-     200.71832520 meV/A
Kong-Liu effective sample size =  396.12419553802914


 ==== STRESS TENSOR [GPa] ==== 
    161.29075385      0.00000000      0.00000000                0.34837928      0.00000000      0.00000000
      0.00000000    161.29075385     -0.00000000    +-          0.00000000      0.34837928      0.00000000
      0.00000000     -0.00000000    161.29043593                0.00000000      0.00000000      0.55826675

 Ab initio average stress [GPa]:
    157.36742136      0.00000000      0.00000000
      0.00000000    157.36742136     -0.00000000
      0.00000000     -0.00000000    157.43887873

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The previous command, as always, plots the results of the minimizations and prints the information on the last minimization, as the free energy and the final stress tensor.</p>
<p>It is printing two kinds of stress tensors: the real one, and the average over the ab-initio stresses.</p>
<p>The latter is just the stochastic average over the ab-initio stresses, however, it does not include the kinetic contribution, so it is not the real stress (see <a href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.98.024106">Monacelli et. al. Phys. Rev. B 98, 024106</a>).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[65]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spglib</span><span class="o">.</span><span class="n">get_spacegroup</span><span class="p">(</span><span class="n">relax</span><span class="o">.</span><span class="n">minim</span><span class="o">.</span><span class="n">dyn</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_ase_atoms</span><span class="p">(),</span> <span class="mf">0.05</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[65]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>u&#39;Fm-3m (225)&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[55]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spglib</span><span class="o">.</span><span class="n">get_spacegroup</span><span class="p">(</span><span class="n">dyn</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_ase_atoms</span><span class="p">(),</span> <span class="mf">0.1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[55]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>u&#39;R-3m (166)&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[59]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">view</span><span class="p">(</span><span class="n">relax</span><span class="o">.</span><span class="n">minim</span><span class="o">.</span><span class="n">dyn</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_ase_atoms</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[58]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">ase.visualize</span> <span class="k">import</span> <span class="n">view</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[60]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">relax</span><span class="o">.</span><span class="n">minim</span><span class="o">.</span><span class="n">dyn</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">unit_cell</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[60]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>array([[ 1.79783817e+00, -1.03798235e+00,  2.91372421e+00],
       [-2.43331324e-15,  2.07596470e+00,  2.91372421e+00],
       [-1.79783817e+00, -1.03798235e+00,  2.91372421e+00]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
 

